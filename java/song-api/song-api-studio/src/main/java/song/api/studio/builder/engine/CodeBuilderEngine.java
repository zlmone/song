package song.api.studio.builder.engine;import song.common.io.WriterHelper;import song.common.lang.ConvertHelper;import song.common.lang.StringHelper;import org.apache.velocity.VelocityContext;import org.apache.velocity.app.VelocityEngine;import java.io.StringWriter;/** * description: * author:          song * createDate:      2017/11/2 */public class CodeBuilderEngine {    private VelocityEngine engine;    public CodeBuilderEngine() {       /* engine.setProperty(RuntimeConstants.RESOURCE_LOADER, "classpath");        engine.setProperty("classpath.resource.loader.class", ClasspathResourceLoader.class.getName());*/        engine = new VelocityEngine();        engine.init();    }    /**     * 生成代码     *     * @param templateContent     * @param data     * @return     */    public String builder(String templateContent, CodeBuilderData data) {        if (StringHelper.isEmpty(templateContent)) {            return StringHelper.getEmpty();        }        StringWriter writer = new StringWriter();        try {            //添加运行时数据            VelocityContext context = new VelocityContext();            context.put("context", data.getProject());            context.put("table", data.getTable());            context.put("dataType", data.getDataType());            context.put("attr", data.getAttributes());            context.put("columns", data.getColumns());            //添加帮助类            context.put("StringHelper", StringHelper.class);            context.put("CodeHelper", CodeHelper.class);            context.put("ConvertHelper", ConvertHelper.class);            engine.evaluate(context, writer, "codebuilderTemplate", templateContent);            String output = writer.toString();            return output;        } finally {            WriterHelper.close(writer);        }    }    /*public static void main(String[] args) {        Project project = new Project();        project.setNameSpace("project1");        Table table = new Table();        table.setTableName("table1");        CodeBuilderData data = new CodeBuilderData();        data.setProject(project);        data.setTable(table);        String template = "";        template += "${StringHelper.toUpperFirst($context.getNameSpace())}${dataType.get(\"String\").get(\"java\")}";        CodeBuilderEngine engine = new CodeBuilderEngine();        String code = engine.builder(template, data);        System.out.println(code.trim());    }*/}