package song.api.studio.controller;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.web.bind.annotation.PostMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;import song.api.studio.builder.metadata.MetadataHelper;import song.api.studio.model.Connection;import song.api.studio.service.impl.ConnectionService;import song.common.db.DBColumn;import song.common.db.DBType;import song.common.io.FileHelper;import song.common.result.ActionResult;import song.common.toolkit.db.orm.DBSession;import song.common.toolkit.pdm.PdmParser;import song.common.toolkit.pdm.PdmTable;import java.util.ArrayList;import java.util.List;import java.util.Map;/** * description: * author:          song * createDate:      2018/11/26 */@RestController@RequestMapping("/datamodel")public class DataModelController {    @Autowired    private ConnectionService connectionService;    @PostMapping(value = "/db")    public ActionResult saveDbModel(Map<String, String> params) throws Exception {        String connectionId = params.get("connectionId");        String tableName = params.get("tableName");        Connection connection = connectionService.findById(connectionId);        DBType dbType = connection.getDbType();        String url = connection.getConnectionString();        //获取数据库表的元数据        DBSession dbSession = new DBSession(dbType, url, connection.getUserName(), connection.getPassword());        String sql = MetadataHelper.getColumnsSql(dbType);        List<Object> sqlParams = new ArrayList<>();        sqlParams.add(tableName);        List<DBColumn> columns = dbSession.toList(DBColumn.class, sql, sqlParams);        return null;    }    @PostMapping(value = "/pdm")    public ActionResult savePdmModel(Map<String, String> params) throws Exception {        String filePath = params.get("filePath");        if (FileHelper.exists(filePath)) {            PdmParser parser = new PdmParser(filePath);            List<PdmTable> pdmTables = parser.parse();            //解析完成，删除pdm文件            FileHelper.delete(filePath);            return new ActionResult(true);        }        return new ActionResult(false);    }}